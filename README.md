# Alert Hub - Security Microservice

Spring Boot service providing authentication (JWT), authorization (roles/permissions), and user/role management for the Alert Hub platform.

## Tech Stack
- Spring Boot 3
- Spring Security (JWT)
- Spring Data JPA
- MySQL (runtime), H2 (optional for local tests)
- Lombok
- springdoc OpenAPI

## Database Schema
Tables generated by JPA:
- users(id, username, email, phone, password, is_admin)
- roles(id, role)
- user_role(id, user_id, role_id)

On startup, default permissions are created and an Admin user is seeded with all permissions.

Default roles:
- createAction, updateAction, deleteAction
- createMetric, updateMetric, deleteMetric
- triggerScan, triggerProcess, triggerEvaluation
- read

## JWT
The JWT includes the following claims:
- user_id, username, is_admin, permissions[]

## Endpoints
- POST /auth/login → returns JWT
- GET /auth/me → current user info + permissions
- POST /users → create user (admin only)
- GET /users → list users (admin only)
- POST /users/{id}/roles → assign role to user (admin only)
- DELETE /users/{id}/roles/{roleId} → remove role (admin only)
- GET /ai/models → expose enabled AI models (feature flag)

## Swagger / OpenAPI
OpenAPI docs available at:
- /swagger-ui.html
- /v3/api-docs

## Configuration
See `src/main/resources/application.properties` and override with environment variables in production:
- spring.datasource.url, spring.datasource.username, spring.datasource.password
- jwt.secret, jwt.expiration-ms
- app.admin.username, app.admin.email, app.admin.password
- app.ai.enabledModels (e.g., `claude-haiku-4.5`)

## Run locally
1. Start MySQL and update datasource credentials in application.properties or via env vars.
2. Build and run with Maven or your IDE.

## Notes
- Passwords are stored hashed with BCrypt.
- Admin user can manage users/roles.
- Permissions in JWT map to actions in other microservices.
